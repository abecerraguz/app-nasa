{{> partials/navbar }}

<div class="container">
    <div class="row">

   
    <div class="row">
      <div class="contenedor">
        <h2 class="mt-2 text-center">ðŸ‘½ Bienvenido a LA NASA ðŸ‘½</h2>
        <hr>
         <p class="mt-3">{{> partials/title}} Registrese para poder pasar a evaluaciÃ³n</p>
        <div class="mb-4">
            <table class="table">
                <thead>
                    <tr>
                    <th scope="col">#</th>
                    <th scope="col">Nombre</th>
                    <th scope="col">Correo</th>
                    <th scope="col">Validado</th>
                    <th scope="col">Editar</th>
                    </tr>
                </thead>
                <tbody>
                   
                    {{#each usuarios}}
                    <tr>
                        <td>{{@index}}</td>
                        <td>{{this.nombre}}</td>
                        <td>{{this.email}}</td>
                        <td><input class="form-check-input" type="checkbox" {{#if this.auth}}checked {{/if}} onclick="changeStatus(this)" id="{{this.id}}"></td>
                        <td><button type="button" class="btn btn-danger btn-sm" onclick="eliminarUsuario( {{this.id}})">Eliminar</button></td>
                    </tr>
                     {{/each}}
                </tbody>
            </table>

        </div>
      </div>

        <!-- Modal Mensaje -->
        <div class="modal fade" id="mensajesModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
            <div class="modal-body text-center text-uppercase my-2">
                <span id="mensaje">Usuario Eliminado !!</span>
            </div>
            </div>
        </div>
        </div>

<script>

   const modal = (msg)=>{
         $('#mensajesModal').modal('toggle'); 
         $('#mensaje').html(msg);
         setTimeout(()=>{
            $('#mensajesModal').modal('toggle'); 
         },3000)
   }

   const changeStatus = async( e ) => {
        console.log('Salida de e-->',e)
        let auth = e.checked;
        let id   = e.id

        await axios.put("http://localhost:3000/usuario",{
            id,
            auth
        })
        auth ?
            modal('Usuario habilitado para subir fotos')
        :
            modal('Usuario deshabilitado para subir fotos')
   
   }


   const eliminarUsuario = async (id) =>{
        await axios.delete(`http://localhost:3000/usuario/${id}`)
            .then(()=>{
                $('#mensajesModal').modal('toggle'); 
                setTimeout(()=>{
                    $('#mensajesModal').modal('toggle'); 
                    window.location.reload();
                },3000)
            })
   }

   
</script>